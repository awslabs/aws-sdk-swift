//
// Copyright Amazon.com Inc. or its affiliates.
// All Rights Reserved.
//
// SPDX-License-Identifier: Apache-2.0
//

// Code generated by smithy-swift-codegen. DO NOT EDIT!

import enum Smithy.ClientError
import protocol AWSSDKIdentity.S3ExpressCreateSessionClient
import protocol ClientRuntime.DefaultClientConfiguration
import struct AWSSDKIdentity.S3ExpressIdentity


public struct S3ExpressCreateSessionClient: AWSSDKIdentity.S3ExpressCreateSessionClient, Swift.Sendable {

    public func createSession(clientConfig: ClientRuntime.DefaultClientConfiguration, bucket: Swift.String) async throws -> AWSSDKIdentity.S3ExpressIdentity {
        guard let config = clientConfig as? S3Client.Config else {
            throw Smithy.ClientError.authError("Client config not supplied")
        }
        let client = S3Client(config: config)
        let input = CreateSessionInput(bucket: bucket)
        let output = try await client.createSession(input: input)
        guard let creds = output.credentials, let accessKeyID = creds.accessKeyId, let secretAccessKey = creds.secretAccessKey, let sessionToken = creds.sessionToken else { fatalError() }
        return AWSSDKIdentity.S3ExpressIdentity(
            accessKeyID: accessKeyID,
            secretAccessKey: secretAccessKey,
            sessionToken: sessionToken,
            expiration: output.credentials?.expiration
        )
    }
}
