#!/bin/bash -eo pipefail

# Regenerates the SDK.  For use during development only.
# Run this script from the SDK project root directory.

# Quit Xcode so it doesn't get overwhelmed by source file changes.
osascript -e 'quit app "Xcode"'

# Delete the current autogenerated SDK code
rm -rf release/

# Regenerate code
./gradlew -p codegen/sdk-codegen build
./gradlew -p codegen/sdk-codegen stageSdks

# Merge the newly built models
./scripts/mergeModels.sh release

# Regenerate the package manifest
./scripts/generatePackageSwift.swift > Package.swift

# Open Xcode to the newly refreshed SDK
open -a Xcode
